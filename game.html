<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å°æ¸¸æˆ | æœˆä¹‹æ£®çš„é»„ç“œæ¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="bg-canvas"></canvas>

  <header class="site-header">
    <div class="container navbar">
      <a href="index.html" class="logo">æœˆã®æ£®<span>ğŸ¥’</span></a>
      <nav class="nav-links">
        <a href="index.html" class="nav-link">ä¸»é¡µ</a>
        <a href="about.html" class="nav-link">å…³äºæˆ‘</a>
        <a href="projects.html" class="nav-link">é¡¹ç›®</a>
        <a href="contact.html" class="nav-link">è”ç³»</a>
	<a href="game.html" class="nav-link active">å°æ¸¸æˆ</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section>
      <h1 class="section-title">å¼¹å¹•ç”Ÿå­˜ç»ƒä¹ åœº</h1>
      <p class="section-subtitle">
        ç”¨æ–¹å‘é”®ç§»åŠ¨ä½ çš„æœºä½“ï¼ŒæŒ‰ä½ Shift è¿›å…¥ä½é€Ÿæ¨¡å¼ï¼Œå°½é‡åœ¨å¼¹å¹•ä¸­æ´»å¾—æ›´ä¹…ã€‚<br />
        åˆ«è¢«æ‰“ä¸­ã€‚
      </p>

      <div class="game-wrapper">
        <!-- ç«–ç‰ˆ STG æ¯”ä¾‹ -->
        <canvas id="game-canvas" width="360" height="480"></canvas>

        <div class="btn-row" style="margin-top: 0.75rem;">
          <button id="start-btn" class="btn btn-primary" type="button">
            å¼€å§‹ / é‡æ¥
          </button>
        </div>

        <p class="section-subtitle" style="margin-top: 0.6rem;">
          æ“ä½œï¼šâ†‘ â†“ â† â†’ ç§»åŠ¨ï¼Œ<strong>Shift</strong> ä½é€Ÿç²¾ç¡®ç§»åŠ¨ã€‚<br />
          å°åœ†ç‚¹å°±æ˜¯ä½ ï¼Œå½©è‰²å¼¹å¹•æ“¦ç€è¿‡æ²¡æ’ä¸Šä¼šè®¡å…¥æ“¦å¼¹ã€‚
        </p>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container">
      Â© 2025 æœˆä¹‹æ£®çš„é»„ç“œæ¶ Â· Bullet Practice
    </div>
  </footer>

  <!-- ç²’å­èƒŒæ™¯ -->
  <script src="particles.js"></script>

  <!-- å¼¹å¹•æ¸¸æˆè„šæœ¬ -->
  <script>
    (function () {
      const canvas = document.getElementById("game-canvas");
      const ctx = canvas.getContext("2d");

      const width = canvas.width;
      const height = canvas.height;

      // ç©å®¶ï¼ˆæœºä½“ï¼‰
      const player = {
        x: width / 2,
        y: height - 70,
        hitRadius: 4,    // åˆ¤å®šç‚¹åŠå¾„ï¼ˆå¾ˆå°ï¼‰
        drawRadius: 9,   // å®é™…ç”»å‡ºæ¥çš„å¤§å°
        baseSpeed: 3.6,
      };

      // è¾“å…¥çŠ¶æ€
      const keys = {
        ArrowLeft: false,
        ArrowRight: false,
        ArrowUp: false,
        ArrowDown: false,
        Shift: false,
      };

      // å­å¼¹
      const bullets = [];

      // æ¸¸æˆçŠ¶æ€
      let lastTime = 0;
      let timeAlive = 0;      // å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰
      let bestTime = 0;
      let grazes = 0;         // æ“¦å¼¹æ¬¡æ•°
      let bestGrazes = 0;
      let playing = false;
      let patternTimer = 0;
      let spiralAngle = 0;

      // æ“¦å¼¹åˆ¤å®šåŠå¾„ï¼ˆå¤§äºåˆ¤å®šç‚¹ï¼Œå°äºå¿…ä¸­çš„èŒƒå›´ï¼‰
      const grazeRadius = 24;

      function resetGame() {
        player.x = width / 2;
        player.y = height - 70;
        bullets.length = 0;
        timeAlive = 0;
        grazes = 0;
        patternTimer = 0;
        spiralAngle = 0;
        playing = true;
      }

      function spawnCirclePattern() {
        const cx = width / 2;
        const cy = 90;
        const count = 26;
        const baseSpeed = 1.5 + Math.random() * 0.6;

        for (let i = 0; i < count; i++) {
          const angle = (i / count) * Math.PI * 2;
          const speed = baseSpeed + (Math.random() - 0.5) * 0.2;
          bullets.push(createBullet(cx, cy, angle, speed));
        }
      }

      function spawnFanPattern() {
        const cx = width / 2 + (Math.random() - 0.5) * 80;
        const cy = 70 + Math.random() * 40;
        const count = 13;
        const spread = Math.PI * 0.8; // æ‰‡å½¢è§’åº¦
        const baseAngle = Math.PI / 2; // æœä¸‹
        const baseSpeed = 1.7 + Math.random() * 0.5;

        for (let i = 0; i < count; i++) {
          const t = i / (count - 1) - 0.5;
          const angle = baseAngle + t * spread;
          bullets.push(createBullet(cx, cy, angle, baseSpeed));
        }
      }

      function spawnSpiralPattern() {
        const cx = width / 2;
        const cy = 90;
        const speed = 1.8;
        // ä¸€æ¬¡ç”Ÿæˆä¸¤æ¡åå‘æ—‹è½¬çš„èºæ—‹
        for (let k = 0; k < 2; k++) {
          const offset = k === 0 ? 0 : Math.PI;
          const angle = spiralAngle + offset;
          bullets.push(createBullet(cx, cy, angle, speed));
        }
        spiralAngle += 0.25;
      }

      function createBullet(cx, cy, angle, speed) {
        const r = 4.5 + Math.random() * 1.8;
        const hue = 190 + Math.random() * 100; // è“é’åˆ°ç²‰ä¸€ç‚¹
        return {
          x: cx,
          y: cy,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          r,
          baseR: r,
          hue,
          alpha: 0.9,
          grazed: false,
        };
      }

      function update(dt) {
        if (!playing) return;

        // dt æ˜¯ç›¸å¯¹ 60fps çš„å€ç‡ï¼Œé˜²æ­¢å¸§ç‡å˜åŒ–å¤ªå¤§
        const speedFactor = dt;
        let speed = player.baseSpeed * speedFactor;
        if (keys.Shift) {
          speed *= 0.45; // ä½é€Ÿæ¨¡å¼
        }

        if (keys.ArrowLeft) player.x -= speed;
        if (keys.ArrowRight) player.x += speed;
        if (keys.ArrowUp) player.y -= speed;
        if (keys.ArrowDown) player.y += speed;

        // è¾¹ç•Œ
        const margin = 12;
        if (player.x < margin) player.x = margin;
        if (player.x > width - margin) player.x = width - margin;
        if (player.y < margin) player.y = margin;
        if (player.y > height - margin) player.y = height - margin;

        // è®¡æ—¶
        timeAlive += dt / 60; // dt çº¦ç­‰äºå¸§æ•° -> æ¢ç®—æˆç§’

        // å¼¹å¹•æ¨¡å¼å®šæ—¶å™¨ï¼šéšæœºè½®æµæ”¾å‡ ç§ pattern
        patternTimer -= dt;
        if (patternTimer <= 0) {
          const choice = Math.random();
          if (choice < 0.4) {
            spawnCirclePattern();
            patternTimer = 40 + Math.random() * 15;
          } else if (choice < 0.8) {
            spawnFanPattern();
            patternTimer = 32 + Math.random() * 12;
          } else {
            // èºæ—‹ä¼šè¿æ”¾å‡ æ¬¡
            for (let i = 0; i < 6; i++) {
              spawnSpiralPattern();
            }
            patternTimer = 42 + Math.random() * 18;
          }
        } else {
          // å¶å°”æ’å…¥å•å‘èºæ—‹æµï¼Œä¿æŒåœºé¢
          if (patternTimer % 10 < 1) {
            spawnSpiralPattern();
          }
        }

        // æ›´æ–°å¼¹å¹•
        for (const b of bullets) {
          b.x += b.vx * speedFactor;
          b.y += b.vy * speedFactor;

          // è½»å¾®å‘¼å¸æ•ˆæœ
          const t = timeAlive * 3;
          b.r = b.baseR * (0.9 + 0.2 * Math.sin(t + b.hue));

          // æ“¦å¼¹åˆ¤å®šï¼ˆåˆ¤å®šåœˆå¤–ã€æ“¦å¼¹åœˆå†…ï¼‰
          const dx = b.x - player.x;
          const dy = b.y - player.y;
          const dist2 = dx * dx + dy * dy;
          const hitR2 = (player.hitRadius + b.r) * (player.hitRadius + b.r);
          const grazeR2 = (grazeRadius + b.r) * (grazeRadius + b.r);

          if (dist2 < hitR2) {
            // è¢«æ‰“ä¸­
            playing = false;
            bestTime = Math.max(bestTime, timeAlive);
            bestGrazes = Math.max(bestGrazes, grazes);
            break;
          }

          if (!b.grazed && dist2 >= hitR2 && dist2 < grazeR2) {
            b.grazed = true;
            grazes += 1;
          }
        }

        // æ¸…ç†é£å‡ºç”»é¢çš„å¼¹
        for (let i = bullets.length - 1; i >= 0; i--) {
          const b = bullets[i];
          if (
            b.x < -40 ||
            b.x > width + 40 ||
            b.y < -60 ||
            b.y > height + 60
          ) {
            bullets.splice(i, 1);
          }
        }
      }

      function draw() {
        // èƒŒæ™¯ï¼šæ·±è‰²æ¸å˜
        const grd = ctx.createLinearGradient(0, 0, 0, height);
        grd.addColorStop(0, "rgba(15,23,42,1)");
        grd.addColorStop(1, "rgba(15,23,42,0.96)");
        ctx.fillStyle = grd;
        ctx.fillRect(0, 0, width, height);

        // åŠé€æ˜é®ç½©ï¼Œè®©æ‹–å°¾æ›´æŸ”å’Œä¸€ç‚¹
        ctx.fillStyle = "rgba(15, 23, 42, 0.12)";
        ctx.fillRect(0, 0, width, height);

        // ç”»å¼¹å¹•ï¼ˆå‘å…‰å°åœ†ç‚¹ï¼‰
        for (const b of bullets) {
          const r = b.r * 2.2;
          const g = ctx.createRadialGradient(
            b.x,
            b.y,
            0,
            b.x,
            b.y,
            r
          );
          g.addColorStop(
            0,
            `hsla(${b.hue}, 100%, 75%, ${b.alpha})`
          );
          g.addColorStop(1, "rgba(15,23,42,0)");
          ctx.fillStyle = g;
          ctx.beginPath();
          ctx.arc(b.x, b.y, r, 0, Math.PI * 2);
          ctx.fill();
        }

        // ç©å®¶æœºä½“ï¼šå°åˆ¤å®šç‚¹ + å¤–åœˆ
        // å¤–åœˆ
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.drawRadius, 0, Math.PI * 2);
        ctx.fillStyle = "rgba(56, 189, 248, 0.18)";
        ctx.fill();

        // åˆ¤å®šç‚¹
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.hitRadius, 0, Math.PI * 2);
        ctx.fillStyle = "#38bdf8";
        ctx.fill();

        // HUD æ–‡æœ¬
        ctx.fillStyle = "#e5e7eb";
        ctx.font = "13px system-ui, -apple-system, BlinkMacSystemFont, sans-serif";
        ctx.textAlign = "left";

        const timeStr = timeAlive.toFixed(1);
        const bestStr = bestTime.toFixed(1);

        ctx.fillText(`Time: ${timeStr}s`, 10, 20);
        ctx.fillText(`Best: ${bestStr}s`, 10, 38);
        ctx.fillText(`Grazes: ${grazes}`, 10, 56);
        ctx.fillText(`Best Grazes: ${bestGrazes}`, 10, 74);

        if (!playing) {
          ctx.fillStyle = "rgba(15,23,42,0.78)";
          ctx.fillRect(0, height / 2 - 40, width, 80);

          ctx.fillStyle = "#e5e7eb";
          ctx.textAlign = "center";
          ctx.font = "16px system-ui, -apple-system, BlinkMacSystemFont, sans-serif";
          const msg =
            timeAlive === 0
              ? "æŒ‰â€œå¼€å§‹ / é‡æ¥â€è¿›å…¥å¼¹å¹•ç»ƒä¹ "
              : "è¢«å‡»ä¸­äº†ï¼å†æŒ‘æˆ˜ä¸€æŠŠï¼Ÿ";
          ctx.fillText(msg, width / 2, height / 2 - 4);
          ctx.font = "13px system-ui, -apple-system, BlinkMacSystemFont, sans-serif";
          ctx.fillText("â†‘â†“â†â†’ ç§»åŠ¨ Â· Shift ä½é€Ÿ", width / 2, height / 2 + 18);
        }
      }

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;
        const dt = (timestamp - lastTime) / 16.67; // ä»¥ 60fps åšå½’ä¸€åŒ–
        lastTime = timestamp;

        update(dt);
        draw();
        requestAnimationFrame(loop);
      }

           // è¾“å…¥äº‹ä»¶ï¼šæ‹¦æˆªæ–¹å‘é”®é¿å…é¡µé¢æ»šåŠ¨
      window.addEventListener("keydown", (e) => {
        if (e.key in keys || e.key === "Shift") {
          // é˜»æ­¢æµè§ˆå™¨ç”¨æ–¹å‘é”®æ»šåŠ¨é¡µé¢
          e.preventDefault();
        }

        if (e.key in keys) {
          keys[e.key] = true;
        }
        if (e.key === "Shift") {
          keys.Shift = true;
        }
      });

      window.addEventListener("keyup", (e) => {
        if (e.key in keys) {
          keys[e.key] = false;
        }
        if (e.key === "Shift") {
          keys.Shift = false;
        }
      });


      document.getElementById("start-btn").addEventListener("click", () => {
        resetGame();
      });

      // åˆå§‹ç»˜åˆ¶ + å¼€å§‹å¾ªç¯
      draw();
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
