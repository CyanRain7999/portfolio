<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>è¯æ¡ç”Ÿæˆå™¨ | æœˆä¹‹æ£®çš„é»„ç“œæ¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="bg-canvas"></canvas>

  <div class="shell">
    <header class="site-header">
      <div class="container header-inner">
        <a href="index.html" class="logo">æœˆã®æ£®<span>ğŸ¥’</span></a>
        <nav class="nav-links">
          <a href="boardgame.html" class="nav-link">æ¡Œæ¸¸å¡åŒ…</a>
          <a href="boardgame-reference.html" class="nav-link">è§„åˆ™ä¸è¯æ¡</a>
          <a href="index.html" class="nav-link">èµ„æ–™é¦†é¦–é¡µ</a>
        </nav>
      </div>
    </header>

    <main class="container boardgame-ref-main">
      <section class="hero">
        <p class="eyebrow">Tools Â· Term Generator</p>
        <h1 class="hero-title">æœ¯è¯­ / è¯æ¡ç”Ÿæˆå™¨</h1>
        <p class="hero-subtitle">
          å¡«å†™è¯æ¡ â†’ æ·»åŠ åˆ°åˆ—è¡¨ â†’ ä¸€é”®ç”Ÿæˆèƒ½ç›´æ¥ç²˜è´´è¿› <code>boardgame-reference.html</code> çš„ <code>TERMS</code> æ•°ç»„ä»£ç ã€‚
        </p>
      </section>

      <section class="boardgame-ref-grid">
        <!-- å·¦ï¼šè¾“å…¥ä¸åˆ—è¡¨ -->
        <div class="boardgame-ref-panel">
          <h2 class="section-title small">æ–°å¢è¯æ¡</h2>

          <div class="form-row">
            <label>è¯æ¡å term</label>
            <input id="f-term" class="input" type="text" placeholder="ä¾‹å¦‚ï¼šæ ¸å¿ƒå•ä½" />
          </div>

          <div class="form-row">
            <label>åˆ†ç±» category</label>
            <input id="f-category" class="input" type="text" placeholder="ä¾‹å¦‚ï¼šå•ä½ / æ ‡ç­¾ / å¡ç‰Œç±»åˆ«" />
          </div>

          <div class="form-row">
            <label>æ ‡ç­¾ tagsï¼ˆé€—å·/ä¸­æ–‡é€—å·åˆ†éš”ï¼‰</label>
            <input id="f-tags" class="input" type="text" placeholder="ä¾‹å¦‚ï¼šå•ä½,æ ¸å¿ƒ,æˆ˜åœº" />
          </div>

          <div class="form-row">
            <label>è§£é‡Š text</label>
            <textarea id="f-text" class="card-gen-textarea" placeholder="å†™è§£é‡Šã€‚æ”¯æŒæ¢è¡Œã€‚"></textarea>
          </div>

          <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
            <button id="btn-add" class="btn btn-primary btn-compact" type="button">ï¼‹ æ·»åŠ åˆ°åˆ—è¡¨</button>
            <button id="btn-clear-form" class="btn btn-ghost btn-compact" type="button">æ¸…ç©ºè¾“å…¥</button>
          </div>

          <hr style="margin:1rem 0; border:none; border-top:1px solid rgba(148,163,184,.45);" />

          <div style="display:flex; align-items:center; justify-content:space-between; gap:.6rem;">
            <h2 class="section-title small" style="margin:0;">å½“å‰è¯æ¡åˆ—è¡¨</h2>
            <button id="btn-clear-all" class="btn btn-ghost btn-xxs" type="button">æ¸…ç©ºå…¨éƒ¨</button>
          </div>

          <div id="term-items" class="term-list-grid" style="margin-top:.8rem;">
            <!-- é¢„è§ˆåˆ—è¡¨ -->
          </div>
        </div>

        <!-- å³ï¼šè¾“å‡º -->
        <div class="boardgame-ref-panel">
          <h2 class="section-title small">ä»£ç è¾“å‡º</h2>
          <p class="section-subtitle">
            ä½ å¯ä»¥ç”Ÿæˆï¼šå•æ¡å¯¹è±¡ï¼ˆç²˜è¿› <code>TERMS</code> æ•°ç»„é‡Œï¼‰ï¼Œæˆ–è€…å®Œæ•´ <code>const TERMS = [...]</code>ã€‚
          </p>

          <div style="display:flex; gap:.5rem; flex-wrap:wrap;">
            <button id="btn-gen-item" class="btn btn-ghost btn-compact" type="button">ç”Ÿæˆï¼šæ‰€é€‰å•æ¡å¯¹è±¡</button>
            <button id="btn-gen-all" class="btn btn-primary btn-compact" type="button">ç”Ÿæˆï¼šå®Œæ•´ TERMS</button>
          </div>

          <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.6rem;">
            <button id="btn-copy" class="btn btn-ghost btn-compact" type="button">å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
            <button id="btn-download" class="btn btn-ghost btn-compact" type="button">ä¸‹è½½ terms-data.js</button>
          </div>

          <div class="form-row" style="margin-top:.8rem;">
            <label>è¾“å‡ºé¢„è§ˆ</label>
            <textarea id="out" class="card-gen-textarea" readonly></textarea>
          </div>

          <details style="margin-top:.6rem;">
            <summary>æ€ä¹ˆç²˜è´´åˆ° reference é‡Œï¼Ÿ</summary>
            <p class="section-subtitle" style="margin-top:.5rem;">
              ä½ çš„ <code>boardgame-reference.html</code> é‡Œæœ‰ <code>const TERMS = [ ... ]</code>ã€‚:contentReference[oaicite:1]{index=1}
              <br/>
              - ç”Ÿæˆâ€œå•æ¡å¯¹è±¡â€ â†’ ç²˜åˆ°æ•°ç»„é‡Œä»»æ„ä½ç½®ï¼Œæ³¨æ„é€—å·ã€‚
              <br/>
              - ç”Ÿæˆâ€œå®Œæ•´ TERMSâ€ â†’ ç›´æ¥ç”¨æ•´æ®µæ›¿æ¢åŸæ¥çš„ <code>const TERMS = [...]</code>ã€‚
            </p>
          </details>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        Â© 2025 æœˆä¹‹æ£®çš„é»„ç“œæ¶ Â· Term Generator
      </div>
    </footer>
  </div>

  <script src="particles.js"></script>
  <script>
    // ---- æ•°æ® ----
    const state = {
      items: [],      // {term, category, tags:[], text}
      selected: -1,
    };

    // ---- å·¥å…· ----
    function splitTags(raw) {
      return String(raw || "")
        .replace(/ï¼Œ/g, ",")
        .split(",")
        .map(s => s.trim())
        .filter(Boolean);
    }

    function jsString(s) {
      // è¾“å‡ºä¸º JS å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆåŒå¼•å·ï¼‰
      return String(s ?? "")
        .replace(/\\/g, "\\\\")
        .replace(/"/g, '\\"')
        .replace(/\\r/g, "")
        .replace(/\\n/g, "\\n");
    }

    function itemToObjectCode(it) {
      const tags = (it.tags || []).map(t => `"${jsString(t)}"`).join(", ");
      return `{
  term: "${jsString(it.term)}",
  category: "${jsString(it.category)}",
  tags: [${tags}],
  text: "${jsString(it.text)}",
},`;
    }

    function allToTermsCode(items) {
      const body = items.map(itemToObjectCode).join("\\n\\n");
      return `// terms-data.js (copy/paste)
// ç›´æ¥æ›¿æ¢ boardgame-reference.html é‡Œçš„ TERMS
const TERMS = [
${body ? body.replace(/^/gm, "  ") : ""}
];`;
    }

    function downloadText(filename, text) {
      const blob = new Blob([text], { type: "text/javascript;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (e) {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        const ok = document.execCommand("copy");
        ta.remove();
        return ok;
      }
    }

    // ---- UI ----
    const el = {
      term: document.getElementById("f-term"),
      category: document.getElementById("f-category"),
      tags: document.getElementById("f-tags"),
      text: document.getElementById("f-text"),
      add: document.getElementById("btn-add"),
      clearForm: document.getElementById("btn-clear-form"),
      clearAll: document.getElementById("btn-clear-all"),
      items: document.getElementById("term-items"),
      out: document.getElementById("out"),
      genItem: document.getElementById("btn-gen-item"),
      genAll: document.getElementById("btn-gen-all"),
      copy: document.getElementById("btn-copy"),
      download: document.getElementById("btn-download"),
    };

    function renderList() {
      el.items.innerHTML = "";

      if (!state.items.length) {
        el.items.innerHTML = `
          <p class="section-subtitle">è¿˜æ²¡æœ‰è¯æ¡ã€‚å·¦è¾¹å¡«å®Œç‚¹â€œæ·»åŠ åˆ°åˆ—è¡¨â€ã€‚</p>
        `;
        return;
      }

      state.items.forEach((it, idx) => {
        const card = document.createElement("article");
        card.className = "term-card";
        card.style.cursor = "pointer";
        card.style.outline = idx === state.selected ? "2px solid rgba(59,122,87,.75)" : "none";

        const tagLine = (it.tags || []).join(" Â· ");

        card.innerHTML = `
          <h3 class="term-title">${escapeHtml(it.term)}</h3>
          <p class="term-meta">
            <span>${escapeHtml(it.category || "")}</span>
            ${tagLine ? `<span class="dot-sep">Â·</span><span>${escapeHtml(tagLine)}</span>` : ""}
          </p>
          <p class="term-text">${escapeHtml(it.text || "")}</p>
          <div style="display:flex; gap:.4rem; margin-top:.5rem; flex-wrap:wrap;">
            <button class="btn btn-ghost btn-xxs" data-act="edit">ç¼–è¾‘</button>
            <button class="btn btn-ghost btn-xxs" data-act="delete">åˆ é™¤</button>
            <button class="btn btn-ghost btn-xxs" data-act="select">é€‰ä¸­</button>
          </div>
        `;

        card.addEventListener("click", () => {
          state.selected = idx;
          renderList();
        });

        card.querySelectorAll("button").forEach(btn => {
          btn.addEventListener("click", (ev) => {
            ev.stopPropagation();
            const act = btn.getAttribute("data-act");
            if (act === "select") {
              state.selected = idx;
              renderList();
              return;
            }
            if (act === "delete") {
              state.items.splice(idx, 1);
              if (state.selected === idx) state.selected = -1;
              if (state.selected > idx) state.selected -= 1;
              renderList();
              return;
            }
            if (act === "edit") {
              // æŠŠæ¡ç›®å¡å›å·¦ä¾§è¡¨å•ï¼Œæ–¹ä¾¿ä½ æ”¹å®Œå†â€œæ·»åŠ â€ä¸€æ¡ï¼ˆæ—§çš„ä½ å¯ä»¥åˆ ï¼‰
              el.term.value = it.term || "";
              el.category.value = it.category || "";
              el.tags.value = (it.tags || []).join(", ");
              el.text.value = it.text || "";
              state.selected = idx;
              renderList();
              return;
            }
          });
        });

        el.items.appendChild(card);
      });
    }

    function escapeHtml(str) {
      return String(str || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function clearForm() {
      el.term.value = "";
      el.category.value = "";
      el.tags.value = "";
      el.text.value = "";
    }

    // ---- äº‹ä»¶ ----
    el.add.addEventListener("click", () => {
      const term = el.term.value.trim();
      const category = el.category.value.trim();
      const tags = splitTags(el.tags.value);
      const text = el.text.value.trim();

      if (!term) {
        alert("term ä¸èƒ½ä¸ºç©º");
        return;
      }
      if (!text) {
        alert("text ä¸èƒ½ä¸ºç©ºï¼ˆè‡³å°‘å†™ä¸€å¥è§£é‡Šï¼‰");
        return;
      }

      state.items.push({ term, category, tags, text });
      state.selected = state.items.length - 1;
      renderList();
      clearForm();
    });

    el.clearForm.addEventListener("click", clearForm);

    el.clearAll.addEventListener("click", () => {
      if (!confirm("ç¡®å®šæ¸…ç©ºå…¨éƒ¨è¯æ¡å—ï¼Ÿ")) return;
      state.items = [];
      state.selected = -1;
      renderList();
      el.out.value = "";
    });

    el.genItem.addEventListener("click", () => {
      if (state.selected < 0 || !state.items[state.selected]) {
        alert("è¯·å…ˆåœ¨å·¦ä¾§è¯æ¡åˆ—è¡¨é‡Œé€‰ä¸­ä¸€æ¡ã€‚");
        return;
      }
      el.out.value = itemToObjectCode(state.items[state.selected]);
    });

    el.genAll.addEventListener("click", () => {
      el.out.value = allToTermsCode(state.items);
    });

    el.copy.addEventListener("click", async () => {
      const text = el.out.value.trim();
      if (!text) {
        alert("è¾“å‡ºæ¡†ä¸ºç©ºï¼Œå…ˆç”Ÿæˆä»£ç å†å¤åˆ¶ã€‚");
        return;
      }
      const ok = await copyToClipboard(text);
      alert(ok ? "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿" : "å¤åˆ¶å¤±è´¥ï¼ˆå¯ä»¥æ‰‹åŠ¨å…¨é€‰å¤åˆ¶ï¼‰");
    });

    el.download.addEventListener("click", () => {
      const text = el.out.value.trim();
      if (!text) {
        alert("è¾“å‡ºæ¡†ä¸ºç©ºï¼Œå…ˆç”Ÿæˆä»£ç å†ä¸‹è½½ã€‚");
        return;
      }
      downloadText("terms-data.js", text + "\\n");
    });

    // åˆå§‹æ¸²æŸ“
    renderList();
  </script>
</body>
</html>
