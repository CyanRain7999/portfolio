<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>è§„åˆ™ä¹¦ç¼–è¾‘å™¨ | æœˆä¹‹æ£®çš„é»„ç“œæ¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="bg-canvas"></canvas>

  <div class="shell">
    <header class="site-header">
      <div class="container header-inner">
        <a href="index.html" class="logo">æœˆã®æ£®<span>ğŸ¥’</span></a>
        <nav class="nav-links">
          <a href="boardgame.html" class="nav-link">æ¡Œæ¸¸å¡åŒ…</a>
          <a href="boardgame-reference.html" class="nav-link">è§„åˆ™ä¸è¯æ¡</a>
          <a href="index.html" class="nav-link">èµ„æ–™é¦†é¦–é¡µ</a>
        </nav>
      </div>
    </header>

    <main class="container boardgame-ref-main">
      <section class="hero">
        <p class="eyebrow">Tools Â· Rulebook Editor</p>
        <h1 class="hero-title">è§„åˆ™ä¹¦ç¼–è¾‘å™¨</h1>
        <p class="hero-subtitle">
          åœ¨è¿™é‡ŒæŒ‰ç« èŠ‚ç¼–è¾‘å®Œæ•´è§„åˆ™ä¹¦çš„æ­£æ–‡ï¼Œç¼–è¾‘å®Œåä¸€é”®ç”Ÿæˆ <code>boardgame-rules.html</code> æ–‡ä»¶å¹¶ä¸‹è½½ã€‚
          <br />
          ä½ åªéœ€è¦æŠŠä¸‹è½½å¥½çš„æ–‡ä»¶ä¸Šä¼ è¦†ç›–åŸæœ‰é¡µé¢ï¼Œå°±å®Œæˆäº†ä¸€æ¬¡çº¿ä¸Šæ”¹ç‰ˆã€‚
        </p>
      </section>

      <section class="boardgame-ref-grid">
        <div class="boardgame-ref-panel">
          <h2 class="section-title small">ç« èŠ‚å†…å®¹</h2>
          <p class="section-subtitle">
            æ¯ä¸€å—å¯¹åº”è§„åˆ™ä¹¦é‡Œçš„ä¸€ä¸ªå¤§ç« èŠ‚ã€‚ç« èŠ‚å†…å¯ä»¥æ·»åŠ å¤šæ®µæ­£æ–‡ï¼Œæ¯æ®µä¼šå˜æˆä¸€ä¸ªç‹¬ç«‹çš„æ®µè½ã€‚
          </p>

          <div id="sections-container" class="rules-editor-sections">
            <!-- ç« èŠ‚ç¼–è¾‘åŒºç”± JS åˆå§‹åŒ– -->
          </div>

          <button id="add-section-btn" class="btn btn-ghost btn-compact" type="button">
            ï¼‹ æ–°å»ºç« èŠ‚
          </button>
        </div>

        <div class="boardgame-ref-panel">
          <h2 class="section-title small">å¯¼å‡ºè§„åˆ™ä¹¦ HTML</h2>
          <p class="section-subtitle">
            ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ï¼Œä¼šæ ¹æ®å½“å‰å¡«å†™çš„å†…å®¹ç”Ÿæˆå®Œæ•´çš„
            <code>boardgame-rules.html</code> æ–‡ä»¶å¹¶è§¦å‘ä¸‹è½½ã€‚
          </p>

          <button id="export-btn" class="btn btn-primary" type="button">
            å¯¼å‡ºå¹¶ä¸‹è½½è§„åˆ™ä¹¦ HTML
          </button>

          <p class="section-subtitle" style="margin-top: 0.75rem;">
            ä¸‹è½½å®Œæˆåï¼Œåªéœ€è¦åœ¨ GitHub ä»“åº“é‡Œç”¨è¿™ä¸ªæ–‡ä»¶è¦†ç›–åŸæœ‰çš„
            <code>boardgame-rules.html</code>ï¼Œé™å¾… Pages åˆ·æ–°å³å¯ã€‚
          </p>

          <details class="rules-editor-preview">
            <summary>ï¼ˆå¯é€‰ï¼‰æŸ¥çœ‹å¯¼å‡º HTML é¢„è§ˆ</summary>
            <textarea id="preview-area" class="card-gen-textarea" readonly></textarea>
          </details>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        Â© 2025 æœˆä¹‹æ£®çš„é»„ç“œæ¶ Â· Rulebook Editor
      </div>
    </footer>
  </div>

  <script src="particles.js"></script>
  <script>
    // ====== ç®€å•çš„å·¥å…·å‡½æ•° ======

    function escapeHtml(str) {
      return String(str || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function createParagraphTextarea(initialValue) {
      const wrapper = document.createElement("div");
      wrapper.className = "rules-editor-paragraph-row";

      const textarea = document.createElement("textarea");
      textarea.className = "rules-editor-paragraph";
      textarea.placeholder = "åœ¨è¿™é‡Œè¾“å…¥ä¸€æ®µè§„åˆ™æ­£æ–‡ï¼ˆæ”¯æŒæ¢è¡Œï¼Œå¯¼å‡ºä¼šè‡ªåŠ¨è½¬æˆæ®µè½æˆ–æ¢è¡Œï¼‰";
      textarea.value = initialValue || "";

      const removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.className = "btn btn-ghost btn-xxs";
      removeBtn.textContent = "åˆ é™¤æœ¬æ®µ";

      removeBtn.addEventListener("click", () => {
        wrapper.remove();
      });

      wrapper.appendChild(textarea);
      wrapper.appendChild(removeBtn);

      return wrapper;
    }

    function createSectionBlock(data) {
      const sectionId = data.id || "";
      const title = data.title || "";
      const subheading = data.subheading || "";
      const paragraphs = data.paragraphs || [""];

      const section = document.createElement("div");
      section.className = "rules-editor-section";
      section.dataset.sectionId = sectionId;

      section.innerHTML = `
        <div class="form-row">
          <label>ç« èŠ‚ IDï¼ˆè‹±æ–‡å­—æ¯ï¼Œå°†ä½œä¸º <code>id</code> ä½¿ç”¨ï¼‰</label>
          <input
            type="text"
            class="input rules-editor-section-id"
            placeholder="ä¾‹å¦‚ï¼šcore-rules / dlc1-rules / mirror-rules"
            value="${escapeHtml(sectionId)}"
          />
        </div>
        <div class="form-row">
          <label>ç« èŠ‚æ ‡é¢˜ï¼ˆæ˜¾ç¤ºåœ¨ç½‘é¡µä¸Šçš„å¤§æ ‡é¢˜ï¼‰</label>
          <input
            type="text"
            class="input rules-editor-section-title-input"
            placeholder="ä¾‹å¦‚ï¼šä¸€ã€åŸºç¡€è§„åˆ™ï¼ˆä¸»ä¸–ç•Œ Â· æœ¬ç¯‡ï¼‰"
            value="${escapeHtml(title)}"
          />
        </div>
        <div class="form-row">
          <label>ç« èŠ‚å¯¼è¯­ / å°æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰</label>
          <textarea
            class="card-gen-textarea rules-editor-section-subheading-input"
            placeholder="è¿™é‡Œå†™ä¸€ä¸¤å¥ä»‹ç»è¿™ä¸ªç« èŠ‚çš„å¤§æ„ï¼Œå¯ä»¥ç•™ç©ºã€‚"
          >${escapeHtml(subheading)}</textarea>
        </div>
        <div class="form-row">
          <label>æ­£æ–‡æ®µè½</label>
          <div class="rules-editor-paragraphs"></div>
          <button type="button" class="btn btn-ghost btn-xxs rules-editor-add-paragraph">
            ï¼‹ æ·»åŠ ä¸€æ®µæ­£æ–‡
          </button>
        </div>
        <div class="rules-editor-section-footer">
          <button type="button" class="btn btn-ghost btn-compact rules-editor-remove-section">
            åˆ é™¤æ•´ä¸ªç« èŠ‚
          </button>
        </div>
      `;

      const paragraphsContainer = section.querySelector(".rules-editor-paragraphs");
      paragraphs.forEach((p) => {
        const row = createParagraphTextarea(p);
        paragraphsContainer.appendChild(row);
      });

      const addParagraphBtn = section.querySelector(".rules-editor-add-paragraph");
      addParagraphBtn.addEventListener("click", () => {
        const row = createParagraphTextarea("");
        paragraphsContainer.appendChild(row);
      });

      const removeSectionBtn = section.querySelector(".rules-editor-remove-section");
      removeSectionBtn.addEventListener("click", () => {
        if (confirm("ç¡®å®šè¦åˆ é™¤æ•´ä¸ªç« èŠ‚å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")) {
          section.remove();
        }
      });

      return section;
    }

    function getSectionDataFromDom(section) {
      const id = section.querySelector(".rules-editor-section-id").value.trim();
      const title = section.querySelector(".rules-editor-section-title-input").value.trim();
      const subheading = section
        .querySelector(".rules-editor-section-subheading-input")
        .value
        .trim();

      const paragraphEls = section.querySelectorAll(".rules-editor-paragraph");
      const paragraphs = [];
      paragraphEls.forEach((ta) => {
        const val = ta.value.trim();
        if (val) paragraphs.push(val);
      });

      return { id, title, subheading, paragraphs };
    }

    function generateRulebookHtml(sections) {
      let html = "";

      html += "<!DOCTYPE html>\\n";
      html += '<html lang="zh-CN">\\n';
      html += "<head>\\n";
      html += '  <meta charset="UTF-8" />\\n';
      html += "  <title>å®Œæ•´è§„åˆ™ä¹¦ | æœˆä¹‹æ£®çš„é»„ç“œæ¶</title>\\n";
      html += '  <meta name="viewport" content="width=device-width, initial-scale=1" />\\n';
      html += '  <link rel="stylesheet" href="style.css" />\\n';
      html += "</head>\\n";
      html += "<body>\\n";
      html += '  <canvas id="bg-canvas"></canvas>\\n\\n';
      html += '  <div class="shell">\\n';
      html += "    <header class=\\"site-header\\">\\n";
      html += '      <div class="container header-inner">\\n';
      html += '        <a href="index.html" class="logo">æœˆã®æ£®<span>ğŸ¥’</span></a>\\n';
      html += '        <nav class="nav-links">\\n';
      html += '          <a href="boardgame.html" class="nav-link">æ¡Œæ¸¸å¡åŒ…</a>\\n';
      html += '          <a href="boardgame-reference.html" class="nav-link">è§„åˆ™ä¸è¯æ¡</a>\\n';
      html += '          <a href="index.html" class="nav-link">èµ„æ–™é¦†é¦–é¡µ</a>\\n';
      html += "        </nav>\\n";
      html += "      </div>\\n";
      html += "    </header>\\n\\n";

      html += '    <main class="container boardgame-rules-main">\\n';
      html += "      <section class=\\"hero\\">\\n";
      html += '        <p class="eyebrow">Board Game Â· Rulebook</p>\\n';
      html += '        <h1 class="hero-title">æœˆä¹‹æ£®æ¡Œæ¸¸ Â· å®Œæ•´è§„åˆ™ä¹¦</h1>\\n';
      html +=
        '        <p class="hero-subtitle">è¿™é‡Œæ”¶å½•æ•´æœ¬è§„åˆ™ä¹¦çš„æ­£æ–‡å†…å®¹ï¼ŒåŒ…æ‹¬åŸºç¡€è§„åˆ™ã€æ‰©å±•è§„åˆ™ã€é•œä¸–ç•Œè¿½åŠ è§„åˆ™ï¼Œä»¥åŠ Q&amp;A / å‹˜è¯¯ã€‚</p>\\n';
      html += "      </section>\\n\\n";

      // ç›®å½•
      html += '      <nav class="rulebook-toc">\\n';
      html += '        <p class="toc-title">ç›®å½•å¯¼èˆª</p>\\n';
      html += '        <ul class="toc-list">\\n';
      sections.forEach((sec) => {
        if (!sec.id || !sec.title) return;
        html +=
          '          <li><a href="#' +
          escapeHtml(sec.id) +
          '">' +
          escapeHtml(sec.title) +
          "</a></li>\\n";
      });
      html += "        </ul>\\n";
      html += "      </nav>\\n\\n";

      // å„ç« èŠ‚
      sections.forEach((sec) => {
        if (!sec.id || !sec.title) return;

        html +=
          '      <section id="' +
          escapeHtml(sec.id) +
          '" class="rulebook-section">\\n';
        html +=
          '        <h2 class="rulebook-heading">' +
          escapeHtml(sec.title) +
          "</h2>\\n";

        if (sec.subheading) {
          html +=
            '        <p class="rulebook-subheading">' +
            escapeHtml(sec.subheading) +
            "</p>\\n";
        }

        html += '        <div class="rulebook-body">\\n';

        sec.paragraphs.forEach((p) => {
          // æ¢è¡Œè½¬æˆ <br />ï¼Œå…¶ä»–å­—ç¬¦è¿›è¡Œè½¬ä¹‰
          const safe = escapeHtml(p).replace(/\\n/g, "<br />");
          html += "          <p>" + safe + "</p>\\n";
        });

        html += "        </div>\\n";
        html += "      </section>\\n\\n";
      });

      html += "    </main>\\n\\n";
      html += '    <footer class="site-footer">\\n';
      html += '      <div class="container">\\n';
      html += "        Â© 2025 æœˆä¹‹æ£®çš„é»„ç“œæ¶ Â· Rulebook\\n";
      html += "      </div>\\n";
      html += "    </footer>\\n";
      html += "  </div>\\n\\n";

      html += '  <script src="particles.js"></' + "script>\\n";
      html += "</body>\\n</html>\\n";

      return html;
    }

    function initEditor() {
      const container = document.getElementById("sections-container");
      const addBtn = document.getElementById("add-section-btn");
      const exportBtn = document.getElementById("export-btn");
      const previewArea = document.getElementById("preview-area");

      if (!container) return;

      // åˆå§‹åŒ–ä¸€äº›é»˜è®¤ç« èŠ‚ï¼ˆä½ å¯ä»¥ä¹‹ååœ¨ç¼–è¾‘å™¨é‡Œéšæ„åˆ é™¤/ä¿®æ”¹ï¼‰
      const defaultSections = [
        {
          id: "core-rules",
          title: "ä¸€ã€åŸºç¡€è§„åˆ™ï¼ˆä¸»ä¸–ç•Œ Â· æœ¬ç¯‡ï¼‰",
          subheading:
            "å»ºè®®å°†çº¸è´¨è§„åˆ™ä¹¦ä¸­å…³äº Lv1 å¯¹å±€ç»“æ„ã€åŸºæœ¬åè¯è§£é‡Šã€èµ„æºä¸å›åˆæµç¨‹çš„ç« èŠ‚æ¬åˆ°è¿™é‡Œã€‚",
          paragraphs: [
            "ã€ç¤ºä¾‹ã€‘è¿™é‡Œå†™æ¸…æ¥šä¸€å±€æ¸¸æˆçš„è·èƒœæ¡ä»¶ã€å¤±è´¥æ¡ä»¶ï¼Œä»¥åŠæ˜¯å¦å­˜åœ¨å¹³å±€ã€ç‰¹æ®Šç»“ç®—ç­‰æƒ…å†µã€‚",
            "ã€ç¤ºä¾‹ã€‘è¯´æ˜å¼€å¯å¯¹å±€å‰å¦‚ä½•æ„ç­‘å¡ç»„ã€æ¯ä¸ªå¡åŒ…çš„åŸºç¡€æ•°é‡è¦æ±‚ï¼Œä»¥åŠâ€œæ”¿ç­– / è£…å¤‡ / å•ä½â€ç­‰åŸºæœ¬ç±»åˆ«ã€‚",
          ],
        },
        {
          id: "dlc1-rules",
          title: "äºŒã€æ‰©å±•è§„åˆ™ï¼ˆDLC1ï¼šæ–°æ•™å¾’ / æ£®å¦–æ€ªï¼‰",
          subheading:
            "è¿™é‡Œé›†ä¸­æè¿°å½“ä½¿ç”¨ DLC1 å¡åŒ…æ—¶ï¼Œé¢å¤–å¢åŠ çš„è§„åˆ™ã€å…³é”®å­—ä¸å¯¹åŸºç¡€è§„åˆ™çš„ä¿®æ”¹ã€‚",
          paragraphs: [
            "ã€ç¤ºä¾‹ã€‘æ˜¯å¦éœ€è¦æ›¿æ¢åŸºç¡€å¡ã€å¢åŠ æŸäº›åˆå§‹èµ„æºã€æ”¹åŠ¨èµ·å§‹æ‰‹ç‰Œç­‰ã€‚",
          ],
        },
        {
          id: "mirror-rules",
          title: "ä¸‰ã€é•œä¸–ç•Œè§„åˆ™ï¼ˆDLC2ï¼šé¸¿å›­ç­‰ï¼‰",
          subheading:
            "å½“å¯¹å±€è¿›å…¥é•œä¸–ç•Œæ—¶ï¼Œé‡‡ç”¨ä½•ç§é¢å¤–æµç¨‹ã€æ—¶ç©º/å¹³è¡Œä¸–ç•Œç›¸å…³çš„ç‰¹æ®Šæ¡ç›®åœ¨æ­¤å¤„è¯´æ˜ã€‚",
          paragraphs: [
            "ã€ç¤ºä¾‹ã€‘å†™æ¸…æ¥šè¿›å…¥é•œä¸–ç•Œçš„æ¡ä»¶ï¼Œä»¥åŠé•œä¸–ç•Œä¸­çš„é€šç”¨å˜åŒ–ï¼Œä¾‹å¦‚èµ„æºè§„åˆ™æ˜¯å¦æ”¹å˜ã€å…³é”®å­—æ˜¯å¦è·å¾—æ–°å«ä¹‰ç­‰ã€‚",
          ],
        },
        {
          id: "faq",
          title: "å››ã€Q&A ä¸å‹˜è¯¯",
          subheading:
            "åœ¨è¿™é‡Œé›†ä¸­å›ç­”ç©å®¶å¸¸è§é—®é¢˜ï¼Œå¹¶è®°å½•è§„åˆ™ä¹¦çš„å‹˜è¯¯ä¸ç‰ˆæœ¬æ›´æ–°è¯´æ˜ã€‚",
          paragraphs: [
            "Qï¼šæŸå¼ å¡çš„â€œæœ¬å›åˆä¸­â€æ•ˆæœåœ¨å¯¹æ–¹å›åˆæ˜¯å¦ç»§ç»­ç”Ÿæ•ˆï¼Ÿ\\nAï¼šæ ¹æ®ä½ çš„å®é™…è§„åˆ™è¿›è¡Œå›ç­”ï¼Œåœ¨è¿™é‡Œå†™æ¸…æ¥šåˆ¤å®šåŸåˆ™ã€‚",
          ],
        },
      ];

      defaultSections.forEach((sec) => {
        const block = createSectionBlock(sec);
        container.appendChild(block);
      });

      addBtn.addEventListener("click", () => {
        const block = createSectionBlock({
          id: "",
          title: "",
          subheading: "",
          paragraphs: [""],
        });
        container.appendChild(block);
        block.scrollIntoView({ behavior: "smooth", block: "start" });
      });

      exportBtn.addEventListener("click", () => {
        const sectionEls = container.querySelectorAll(".rules-editor-section");
        const sections = [];

        sectionEls.forEach((el) => {
          const data = getSectionDataFromDom(el);
          if (data.id && data.title && data.paragraphs.length > 0) {
            sections.push(data);
          }
        });

        if (!sections.length) {
          alert("è¯·è‡³å°‘ä¿ç•™ä¸€ä¸ªæœ‰ IDã€æ ‡é¢˜å’Œæ­£æ–‡çš„ç« èŠ‚ã€‚");
          return;
        }

        const html = generateRulebookHtml(sections);

        // é¢„è§ˆ
        if (previewArea) {
          previewArea.value = html;
        }

        // è§¦å‘ä¸‹è½½
        const blob = new Blob([html], { type: "text/html" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "boardgame-rules.html";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });
    }

    document.addEventListener("DOMContentLoaded", initEditor);
  </script>
</body>
</html>
