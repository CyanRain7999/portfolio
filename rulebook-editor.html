<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>è§„åˆ™ä¹¦ç¼–è¾‘å™¨ | æœˆä¹‹æ£®çš„é»„ç“œæ¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="bg-canvas"></canvas>

  <div class="shell">
    <header class="site-header">
      <div class="container header-inner">
        <a href="index.html" class="logo">æœˆã®æ£®<span>ğŸ¥’</span></a>
        <nav class="nav-links">
          <a href="boardgame.html" class="nav-link">æ¡Œæ¸¸å¡åŒ…</a>
          <a href="boardgame-reference.html" class="nav-link">è§„åˆ™ä¸è¯æ¡</a>
          <a href="index.html" class="nav-link">èµ„æ–™é¦†é¦–é¡µ</a>
        </nav>
      </div>
    </header>

    <main class="container boardgame-ref-main">
      <section class="hero">
        <p class="eyebrow">Tools Â· Rulebook Editor</p>
        <h1 class="hero-title">è§„åˆ™ä¹¦ç¼–è¾‘å™¨</h1>
        <p class="hero-subtitle">
          åœ¨è¿™é‡ŒæŒ‰ç« èŠ‚ç¼–è¾‘å®Œæ•´è§„åˆ™ä¹¦çš„æ­£æ–‡ï¼Œç¼–è¾‘å®Œåä¸€é”®ç”Ÿæˆ <code>boardgame-rules.html</code> æ–‡ä»¶å¹¶ä¸‹è½½ã€‚
          <br />
          ä½ åªéœ€è¦æŠŠä¸‹è½½å¥½çš„æ–‡ä»¶ä¸Šä¼ è¦†ç›–åŸæœ‰é¡µé¢ï¼Œå°±å®Œæˆäº†ä¸€æ¬¡çº¿ä¸Šæ”¹ç‰ˆã€‚
        </p>
      </section>

      <section class="boardgame-ref-grid">
        <!-- å·¦ä¾§ï¼šç« èŠ‚ç¼–è¾‘ -->
        <div class="boardgame-ref-panel">
          <h2 class="section-title small">ç« èŠ‚å†…å®¹</h2>
          <p class="section-subtitle">
            æ¯ä¸€å—å¯¹åº”è§„åˆ™ä¹¦é‡Œçš„ä¸€ä¸ªå¤§ç« èŠ‚ã€‚ç« èŠ‚å†…å¯ä»¥æ·»åŠ å¤šæ®µæ­£æ–‡ï¼Œæ¯æ®µä¼šå˜æˆä¸€ä¸ªç‹¬ç«‹çš„æ®µè½ã€‚
          </p>

          <div id="sections-container" class="rules-editor-sections">
            <!-- JS åˆå§‹åŒ–é»˜è®¤ç« èŠ‚ -->
          </div>

          <button id="add-section-btn" class="btn btn-ghost btn-compact" type="button">
            ï¼‹ æ–°å»ºç« èŠ‚
          </button>
        </div>

        <!-- å³ä¾§ï¼šå¯¼å‡º -->
        <div class="boardgame-ref-panel">
          <h2 class="section-title small">å¯¼å‡ºè§„åˆ™ä¹¦ HTML</h2>
          <p class="section-subtitle">
            ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®ï¼Œä¼šæ ¹æ®å½“å‰å¡«å†™çš„å†…å®¹ç”Ÿæˆå®Œæ•´çš„
            <code>boardgame-rules.html</code> æ–‡ä»¶å¹¶è§¦å‘ä¸‹è½½ã€‚
          </p>

          <button id="export-btn" class="btn btn-primary" type="button">
            å¯¼å‡ºå¹¶ä¸‹è½½è§„åˆ™ä¹¦ HTML
          </button>

          <p class="section-subtitle" style="margin-top: 0.75rem;">
            ä¸‹è½½å®Œæˆåï¼Œåªéœ€è¦åœ¨ GitHub ä»“åº“é‡Œç”¨è¿™ä¸ªæ–‡ä»¶è¦†ç›–åŸæœ‰çš„
            <code>boardgame-rules.html</code>ï¼Œé™å¾… Pages åˆ·æ–°å³å¯ã€‚
          </p>

          <details class="rules-editor-preview">
            <summary>ï¼ˆå¯é€‰ï¼‰æŸ¥çœ‹å¯¼å‡º HTML é¢„è§ˆ</summary>
            <textarea id="preview-area" class="card-gen-textarea" readonly></textarea>
          </details>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        Â© 2025 æœˆä¹‹æ£®çš„é»„ç“œæ¶ Â· Rulebook Editor
      </div>
    </footer>
  </div>

  <script src="particles.js"></script>
  <script>
    // ====== ç®€å•å·¥å…·å‡½æ•° ======
    function escapeHtml(str) {
      return String(str || "")
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function createParagraphRow(initialText) {
      var wrapper = document.createElement("div");
      wrapper.className = "rules-editor-paragraph-row";

      var textarea = document.createElement("textarea");
      textarea.className = "rules-editor-paragraph";
      textarea.placeholder = "åœ¨è¿™é‡Œè¾“å…¥ä¸€æ®µè§„åˆ™æ­£æ–‡ï¼ˆæ”¯æŒæ¢è¡Œï¼Œå¯¼å‡ºä¼šè‡ªåŠ¨è½¬æˆæ®µè½ / æ¢è¡Œï¼‰";
      textarea.value = initialText || "";

      var removeBtn = document.createElement("button");
      removeBtn.type = "button";
      removeBtn.className = "btn btn-ghost btn-xxs";
      removeBtn.textContent = "åˆ é™¤æœ¬æ®µ";

      removeBtn.addEventListener("click", function () {
        wrapper.remove();
      });

      wrapper.appendChild(textarea);
      wrapper.appendChild(removeBtn);
      return wrapper;
    }

    function createSectionBlock(data) {
      data = data || {};
      var sectionId = data.id || "";
      var title = data.title || "";
      var subheading = data.subheading || "";
      var paragraphs = data.paragraphs || [""];

      var section = document.createElement("div");
      section.className = "rules-editor-section";

      // ç« èŠ‚ ID
      var rowId = document.createElement("div");
      rowId.className = "form-row";
      var labelId = document.createElement("label");
      labelId.innerHTML = "ç« èŠ‚ IDï¼ˆè‹±æ–‡å­—æ¯ï¼Œå°†ä½œä¸º <code>id</code> ä½¿ç”¨ï¼‰";
      var inputId = document.createElement("input");
      inputId.type = "text";
      inputId.className = "input rules-editor-section-id";
      inputId.placeholder = "ä¾‹å¦‚ï¼šcore-rules / dlc1-rules / mirror-rules";
      inputId.value = sectionId;
      rowId.appendChild(labelId);
      rowId.appendChild(inputId);

      // ç« èŠ‚æ ‡é¢˜
      var rowTitle = document.createElement("div");
      rowTitle.className = "form-row";
      var labelTitle = document.createElement("label");
      labelTitle.textContent = "ç« èŠ‚æ ‡é¢˜ï¼ˆç½‘é¡µä¸Šçš„å¤§æ ‡é¢˜ï¼‰";
      var inputTitle = document.createElement("input");
      inputTitle.type = "text";
      inputTitle.className = "input rules-editor-section-title-input";
      inputTitle.placeholder = "ä¾‹å¦‚ï¼šä¸€ã€åŸºç¡€è§„åˆ™ï¼ˆä¸»ä¸–ç•Œ Â· æœ¬ç¯‡ï¼‰";
      inputTitle.value = title;
      rowTitle.appendChild(labelTitle);
      rowTitle.appendChild(inputTitle);

      // å¯¼è¯­
      var rowSub = document.createElement("div");
      rowSub.className = "form-row";
      var labelSub = document.createElement("label");
      labelSub.textContent = "ç« èŠ‚å¯¼è¯­ / å°æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰";
      var textareaSub = document.createElement("textarea");
      textareaSub.className = "card-gen-textarea rules-editor-section-subheading-input";
      textareaSub.placeholder = "è¿™é‡Œå†™ä¸€ä¸¤å¥ä»‹ç»ï¼Œå¯ä»¥ç•™ç©ºã€‚";
      textareaSub.value = subheading;
      rowSub.appendChild(labelSub);
      rowSub.appendChild(textareaSub);

      // æ­£æ–‡æ®µè½
      var rowParas = document.createElement("div");
      rowParas.className = "form-row";
      var labelParas = document.createElement("label");
      labelParas.textContent = "æ­£æ–‡æ®µè½";
      var parasContainer = document.createElement("div");
      parasContainer.className = "rules-editor-paragraphs";

      paragraphs.forEach(function (p) {
        parasContainer.appendChild(createParagraphRow(p));
      });

      var addParaBtn = document.createElement("button");
      addParaBtn.type = "button";
      addParaBtn.className = "btn btn-ghost btn-xxs rules-editor-add-paragraph";
      addParaBtn.textContent = "ï¼‹ æ·»åŠ ä¸€æ®µæ­£æ–‡";

      addParaBtn.addEventListener("click", function () {
        parasContainer.appendChild(createParagraphRow(""));
      });

      rowParas.appendChild(labelParas);
      rowParas.appendChild(parasContainer);
      rowParas.appendChild(addParaBtn);

      // åˆ é™¤ç« èŠ‚æŒ‰é’®
      var footer = document.createElement("div");
      footer.className = "rules-editor-section-footer";
      var removeSectionBtn = document.createElement("button");
      removeSectionBtn.type = "button";
      removeSectionBtn.className = "btn btn-ghost btn-compact rules-editor-remove-section";
      removeSectionBtn.textContent = "åˆ é™¤æ•´ä¸ªç« èŠ‚";

      removeSectionBtn.addEventListener("click", function () {
        if (confirm("ç¡®å®šè¦åˆ é™¤æ•´ä¸ªç« èŠ‚å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")) {
          section.remove();
        }
      });

      footer.appendChild(removeSectionBtn);

      // ç»„è£… section
      section.appendChild(rowId);
      section.appendChild(rowTitle);
      section.appendChild(rowSub);
      section.appendChild(rowParas);
      section.appendChild(footer);

      return section;
    }

    function getSectionData(section) {
      var id = section.querySelector(".rules-editor-section-id").value.trim();
      var title = section.querySelector(".rules-editor-section-title-input").value.trim();
      var subheading = section
        .querySelector(".rules-editor-section-subheading-input")
        .value
        .trim();

      var paragraphs = [];
      var paraEls = section.querySelectorAll(".rules-editor-paragraph");
      paraEls.forEach(function (ta) {
        var val = ta.value.trim();
        if (val) paragraphs.push(val);
      });

      return { id: id, title: title, subheading: subheading, paragraphs: paragraphs };
    }

    function generateRulebookHtml(sections) {
      var lines = [];

      lines.push("<!DOCTYPE html>");
      lines.push('<html lang="zh-CN">');
      lines.push("<head>");
      lines.push('  <meta charset="UTF-8" />');
      lines.push("  <title>å®Œæ•´è§„åˆ™ä¹¦ | æœˆä¹‹æ£®çš„é»„ç“œæ¶</title>");
      lines.push('  <meta name="viewport" content="width=device-width, initial-scale=1" />');
      lines.push('  <link rel="stylesheet" href="style.css" />');
      lines.push("</head>");
      lines.push("<body>");
      lines.push('  <canvas id="bg-canvas"></canvas>');
      lines.push("");
      lines.push('  <div class="shell">');
      lines.push('    <header class="site-header">');
      lines.push('      <div class="container header-inner">');
      lines.push('        <a href="index.html" class="logo">æœˆã®æ£®<span>ğŸ¥’</span></a>');
      lines.push('        <nav class="nav-links">');
      lines.push('          <a href="boardgame.html" class="nav-link">æ¡Œæ¸¸å¡åŒ…</a>');
      lines.push('          <a href="boardgame-reference.html" class="nav-link">è§„åˆ™ä¸è¯æ¡</a>');
      lines.push('          <a href="index.html" class="nav-link">èµ„æ–™é¦†é¦–é¡µ</a>');
      lines.push("        </nav>");
      lines.push("      </div>");
      lines.push("    </header>");
      lines.push("");
      lines.push('    <main class="container boardgame-rules-main">');
      lines.push('      <section class="hero">');
      lines.push('        <p class="eyebrow">Board Game Â· Rulebook</p>');
      lines.push('        <h1 class="hero-title">æœˆä¹‹æ£®æ¡Œæ¸¸ Â· å®Œæ•´è§„åˆ™ä¹¦</h1>');
      lines.push(
        '        <p class="hero-subtitle">è¿™é‡Œæ”¶å½•æ•´æœ¬è§„åˆ™ä¹¦çš„æ­£æ–‡å†…å®¹ï¼ŒåŒ…æ‹¬åŸºç¡€è§„åˆ™ã€æ‰©å±•è§„åˆ™ã€é•œä¸–ç•Œè¿½åŠ è§„åˆ™ï¼Œä»¥åŠ Q&amp;A / å‹˜è¯¯ã€‚</p>'
      );
      lines.push("      </section>");
      lines.push("");
      // ç›®å½•
      lines.push('      <nav class="rulebook-toc">');
      lines.push('        <p class="toc-title">ç›®å½•å¯¼èˆª</p>');
      lines.push('        <ul class="toc-list">');
      sections.forEach(function (sec) {
        if (!sec.id || !sec.title) return;
        lines.push(
          '          <li><a href="#' +
            escapeHtml(sec.id) +
            '">' +
            escapeHtml(sec.title) +
            "</a></li>"
        );
      });
      lines.push("        </ul>");
      lines.push("      </nav>");
      lines.push("");

      // å„ç« èŠ‚
      sections.forEach(function (sec) {
        if (!sec.id || !sec.title) return;

        lines.push(
          '      <section id="' +
            escapeHtml(sec.id) +
            '" class="rulebook-section">'
        );
        lines.push(
          '        <h2 class="rulebook-heading">' +
            escapeHtml(sec.title) +
            "</h2>"
        );
        if (sec.subheading) {
          lines.push(
            '        <p class="rulebook-subheading">' +
              escapeHtml(sec.subheading) +
              "</p>"
          );
        }
        lines.push('        <div class="rulebook-body">');

        sec.paragraphs.forEach(function (p) {
          var safe = escapeHtml(p).replace(/\n/g, "<br />");
          lines.push("          <p>" + safe + "</p>");
        });

        lines.push("        </div>");
        lines.push("      </section>");
        lines.push("");
      });

      lines.push("    </main>");
      lines.push("");
      lines.push('    <footer class="site-footer">');
      lines.push('      <div class="container">');
      lines.push("        Â© 2025 æœˆä¹‹æ£®çš„é»„ç“œæ¶ Â· Rulebook");
      lines.push("      </div>");
      lines.push("    </footer>");
      lines.push("  </div>");
      lines.push("");
      lines.push('  <script src="particles.js"></' + "script>");
      lines.push("</body>");
      lines.push("</html>");

      return lines.join("\n");
    }

    function initEditor() {
      var container = document.getElementById("sections-container");
      var addBtn = document.getElementById("add-section-btn");
      var exportBtn = document.getElementById("export-btn");
      var previewArea = document.getElementById("preview-area");

      if (!container) return;

      // é»˜è®¤ç»™ä½ å…ˆå¡å‡ ç« ç¤ºä¾‹ï¼Œä¹‹åä½ å¯ä»¥åœ¨é¡µé¢é‡Œç›´æ¥æ”¹ / åˆ 
      var defaultSections = [
        {
          id: "core-rules",
          title: "ä¸€ã€åŸºç¡€è§„åˆ™ï¼ˆä¸»ä¸–ç•Œ Â· æœ¬ç¯‡ï¼‰",
          subheading:
            "å»ºè®®å°†çº¸è´¨è§„åˆ™ä¹¦ä¸­å…³äº Lv1 å¯¹å±€ç»“æ„ã€åŸºæœ¬åè¯è§£é‡Šã€èµ„æºä¸å›åˆæµç¨‹çš„ç« èŠ‚æ¬åˆ°è¿™é‡Œã€‚",
          paragraphs: [
            "ã€ç¤ºä¾‹ã€‘è¿™é‡Œå†™æ¸…æ¥šä¸€å±€æ¸¸æˆçš„è·èƒœæ¡ä»¶ã€å¤±è´¥æ¡ä»¶ï¼Œä»¥åŠæ˜¯å¦å­˜åœ¨å¹³å±€ã€ç‰¹æ®Šç»“ç®—ç­‰æƒ…å†µã€‚",
            "ã€ç¤ºä¾‹ã€‘è¯´æ˜å¼€å¯å¯¹å±€å‰å¦‚ä½•æ„ç­‘å¡ç»„ã€æ¯ä¸ªå¡åŒ…çš„åŸºç¡€æ•°é‡è¦æ±‚ï¼Œä»¥åŠâ€œæ”¿ç­– / è£…å¤‡ / å•ä½â€ç­‰åŸºæœ¬ç±»åˆ«ã€‚"
          ]
        },
        {
          id: "dlc1-rules",
          title: "äºŒã€æ‰©å±•è§„åˆ™ï¼ˆDLC1ï¼šæ–°æ•™å¾’ / æ£®å¦–æ€ªï¼‰",
          subheading:
            "è¿™é‡Œé›†ä¸­æè¿°å½“ä½¿ç”¨ DLC1 å¡åŒ…æ—¶ï¼Œé¢å¤–å¢åŠ çš„è§„åˆ™ã€å…³é”®å­—ä¸å¯¹åŸºç¡€è§„åˆ™çš„ä¿®æ”¹ã€‚",
          paragraphs: [
            "ã€ç¤ºä¾‹ã€‘æ˜¯å¦éœ€è¦æ›¿æ¢åŸºç¡€å¡ã€å¢åŠ æŸäº›åˆå§‹èµ„æºã€æ”¹åŠ¨èµ·å§‹æ‰‹ç‰Œç­‰ã€‚"
          ]
        },
        {
          id: "mirror-rules",
          title: "ä¸‰ã€é•œä¸–ç•Œè§„åˆ™ï¼ˆDLC2ï¼šé¸¿å›­ç­‰ï¼‰",
          subheading:
            "å½“å¯¹å±€è¿›å…¥é•œä¸–ç•Œæ—¶ï¼Œé‡‡ç”¨ä½•ç§é¢å¤–æµç¨‹ã€æ—¶ç©º/å¹³è¡Œä¸–ç•Œç›¸å…³çš„ç‰¹æ®Šæ¡ç›®åœ¨æ­¤å¤„è¯´æ˜ã€‚",
          paragraphs: [
            "ã€ç¤ºä¾‹ã€‘å†™æ¸…æ¥šè¿›å…¥é•œä¸–ç•Œçš„æ¡ä»¶ï¼Œä»¥åŠé•œä¸–ç•Œä¸­çš„é€šç”¨å˜åŒ–ï¼Œä¾‹å¦‚èµ„æºè§„åˆ™æ˜¯å¦æ”¹å˜ã€å…³é”®å­—æ˜¯å¦è·å¾—æ–°å«ä¹‰ç­‰ã€‚"
          ]
        },
        {
          id: "faq",
          title: "å››ã€Q&A ä¸å‹˜è¯¯",
          subheading:
            "åœ¨è¿™é‡Œé›†ä¸­å›ç­”ç©å®¶å¸¸è§é—®é¢˜ï¼Œå¹¶è®°å½•è§„åˆ™ä¹¦çš„å‹˜è¯¯ä¸ç‰ˆæœ¬æ›´æ–°è¯´æ˜ã€‚",
          paragraphs: [
            "Qï¼šæŸå¼ å¡çš„â€œæœ¬å›åˆä¸­â€æ•ˆæœåœ¨å¯¹æ–¹å›åˆæ˜¯å¦ç»§ç»­ç”Ÿæ•ˆï¼Ÿ\nAï¼šæ ¹æ®ä½ çš„å®é™…è§„åˆ™è¿›è¡Œå›ç­”ï¼Œåœ¨è¿™é‡Œå†™æ¸…æ¥šåˆ¤å®šåŸåˆ™ã€‚"
          ]
        }
      ];

      defaultSections.forEach(function (sec) {
        container.appendChild(createSectionBlock(sec));
      });

      addBtn.addEventListener("click", function () {
        container.appendChild(
          createSectionBlock({
            id: "",
            title: "",
            subheading: "",
            paragraphs: [""]
          })
        );
        container.lastElementChild.scrollIntoView({ behavior: "smooth", block: "start" });
      });

      exportBtn.addEventListener("click", function () {
        var sections = [];
        var sectionEls = container.querySelectorAll(".rules-editor-section");

        sectionEls.forEach(function (el) {
          var data = getSectionData(el);
          if (data.id && data.title && data.paragraphs.length > 0) {
            sections.push(data);
          }
        });

        if (!sections.length) {
          alert("è¯·è‡³å°‘ä¿ç•™ä¸€ä¸ªæœ‰ IDã€æ ‡é¢˜å’Œæ­£æ–‡çš„ç« èŠ‚ã€‚");
          return;
        }

        var html = generateRulebookHtml(sections);

        if (previewArea) {
          previewArea.value = html;
        }

        var blob = new Blob([html], { type: "text/html" });
        var url = URL.createObjectURL(blob);
        var a = document.createElement("a");
        a.href = url;
        a.download = "boardgame-rules.html";
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });
    }

    document.addEventListener("DOMContentLoaded", initEditor);
  </script>
</body>
</html>
