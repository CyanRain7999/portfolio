<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å¡ç‰Œæ•°æ®ç”Ÿæˆå™¨ | æœˆä¹‹æ£®çš„é»„ç“œæ¶</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <!-- Excel è§£æåº“ï¼ˆSheetJS ç®€å•ç”¨æ³•ï¼‰ -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <canvas id="bg-canvas"></canvas>

  <div class="shell">
    <header class="site-header">
      <div class="container header-inner">
        <a href="index.html" class="logo">æœˆã®æ£®<span>ğŸ¥’</span></a>
        <nav class="nav-links">
          <a href="index.html" class="nav-link">èµ„æ–™é¦†é¦–é¡µ</a>
          <a href="boardgame.html" class="nav-link">æ¡Œæ¸¸èµ„æ–™é¦†</a>
          <a href="https://cyanrain7999.github.io" class="nav-link">è¿”å›ä¸»ç«™</a>
        </nav>
      </div>
    </header>

    <main class="container card-gen-main">
      <section class="hero">
        <p class="eyebrow">Tools Â· å†…éƒ¨å°å·¥å…·</p>
        <h1 class="hero-title">å¡ç‰Œæ•°æ®ç”Ÿæˆå™¨</h1>
        <p class="hero-subtitle">
          è¯»å– Excelï¼ˆ.xlsxï¼‰ä¸­çš„å•å¡ä¿¡æ¯ï¼Œæ ¹æ®è¡¨å¤´è‡ªåŠ¨ç”Ÿæˆå¯ä»¥ç²˜è´´è¿›
          <code>boardgame-data.js</code> çš„å¡åŒ… / å•å¡æ•°æ®ç‰‡æ®µã€‚
          <br />
          åªåœ¨æœ¬åœ°æµè§ˆå™¨é‡Œè·‘ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•åœ°æ–¹ï¼Œæ˜¯ä½ è‡ªå·±çš„å°å·¥ä½œå°ã€‚
        </p>
      </section>

      <section class="card-gen-section">
        <div class="card-gen-grid">
          <!-- å·¦ä¾§ï¼šé…ç½® + ä¸Šä¼  -->
          <div class="card-gen-panel">
            <h2 class="section-title small">1. é…ç½®å¡åŒ…ä¿¡æ¯</h2>

            <div class="form-row">
              <label for="pack-id">å¡åŒ… idï¼ˆè‹±æ–‡ï¼Œç”¨æ¥å½“ keyï¼‰</label>
              <input
                id="pack-id"
                class="input"
                type="text"
                placeholder="ä¾‹å¦‚ï¼šroyalist-lv1"
              />
            </div>

            <div class="form-row">
              <label for="pack-name">å¡åŒ…åç§°ï¼ˆæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼‰</label>
              <input
                id="pack-name"
                class="input"
                type="text"
                placeholder="ä¾‹å¦‚ï¼šä¿çš‡å…š Lv1"
              />
            </div>

            <div class="form-row">
              <label for="pack-subtitle">å¡åŒ…å‰¯æ ‡é¢˜ï¼ˆå¯é€‰ï¼‰</label>
              <input
                id="pack-subtitle"
                class="input"
                type="text"
                placeholder="ä¾‹å¦‚ï¼šæœ¬ç¯‡ Â· åŸºç¡€å¡ç»„"
              />
            </div>

            <div class="form-row form-row-inline">
              <div class="form-col">
                <label for="pack-side">é˜µè¥ / é˜µè¥è¯´æ˜</label>
                <input
                  id="pack-side"
                  class="input"
                  type="text"
                  placeholder="ä¾‹å¦‚ï¼šä¿çš‡å…š / èµ·ä¹‰å†›"
                />
              </div>
              <div class="form-col">
                <label for="pack-era">æ—¶ä»£ / ä¸–ç•Œï¼ˆå¯é€‰ï¼‰</label>
                <input
                  id="pack-era"
                  class="input"
                  type="text"
                  placeholder="ä¾‹å¦‚ï¼šä¸»ä¸–ç•Œ Â· ä¸€ä»£"
                />
              </div>
            </div>

            <div class="form-row">
              <label for="pack-status">çŠ¶æ€</label>
              <select id="pack-status" class="input">
                <option value="released">å·²æ”¶å½•ï¼ˆreleasedï¼‰</option>
                <option value="wip">æ•´ç†ä¸­ï¼ˆwipï¼‰</option>
                <option value="planned">è®¡åˆ’ä¸­ï¼ˆplannedï¼‰</option>
                <option value="placeholder">å ä½ï¼ˆplaceholderï¼‰</option>
              </select>
            </div>

            <div class="form-row">
              <label for="code-prefix">å¡ç‰Œä»£ç å‰ç¼€ï¼ˆå¯é€‰ï¼Œæ¯”å¦‚ RL1 / RB1ï¼‰</label>
              <input
                id="code-prefix"
                class="input"
                type="text"
                placeholder="ç”¨äºç”Ÿæˆ RL1-01, RL1-02 è¿™æ ·çš„ code"
              />
            </div>

            <hr class="card-gen-divider" />

            <h2 class="section-title small">2. é€‰æ‹© Excel æ–‡ä»¶</h2>
            <p class="card-gen-hint">
              è¡¨å¤´è¯·åŒ…å«ï¼š<code>name</code>ã€<code>category</code>ã€
              <code>number</code>ã€<code>atk&hp</code>ã€
              <code>tags</code>ã€<code>text</code>
            </p>

            <div class="form-row">
              <input
                id="excel-file"
                type="file"
                accept=".xlsx,.xls"
                class="input"
              />
            </div>

            <p id="file-status" class="card-gen-status">
              å°šæœªé€‰æ‹©æ–‡ä»¶ã€‚
            </p>

            <button id="generate-btn" class="btn btn-primary btn-compact" type="button">
              ç”Ÿæˆ JS ç‰‡æ®µ
            </button>
          </div>

          <!-- å³ä¾§ï¼šè¾“å‡º -->
          <div class="card-gen-panel card-gen-output-panel">
            <h2 class="section-title small">3. å¤åˆ¶ç»“æœåˆ° boardgame-data.js</h2>

            <div class="form-row">
              <label for="pack-output">â‘  packs æ•°ç»„é‡Œçš„å¡åŒ…å¯¹è±¡</label>
              <textarea
                id="pack-output"
                class="card-gen-textarea"
                readonly
                placeholder="è¿™é‡Œä¼šç”Ÿæˆä¸€ä¸ªè¦ç²˜è´´è¿› CARD_GAME.packs çš„å¯¹è±¡ç‰‡æ®µâ€¦â€¦"
              ></textarea>
            </div>

            <div class="form-row">
              <label for="cards-output">â‘¡ cards å¯¹è±¡ä¸­çš„è¯¥å¡åŒ…æ¡ç›®</label>
              <textarea
                id="cards-output"
                class="card-gen-textarea"
                readonly
                placeholder="è¿™é‡Œä¼šç”Ÿæˆä¸€ä¸ªè¦ç²˜è´´è¿› CARD_GAME.cards çš„ \"id\": [ ... ] ç‰‡æ®µâ€¦â€¦"
              ></textarea>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        Â© 2025 æœˆä¹‹æ£®çš„é»„ç“œæ¶ Â· Tools
      </div>
    </footer>
  </div>

  <script src="portfolio-particles.js"></script>
  <script>
    const state = {
      rows: []
    };

    const fileInput = document.getElementById("excel-file");
    const statusEl = document.getElementById("file-status");
    const generateBtn = document.getElementById("generate-btn");
    const packOutput = document.getElementById("pack-output");
    const cardsOutput = document.getElementById("cards-output");

    function esc(str) {
      return String(str || "")
        .replace(/\\/g, "\\\\")
        .replace(/"/g, '\\"');
    }

    function handleFileChange(e) {
      const file = e.target.files[0];
      if (!file) {
        state.rows = [];
        statusEl.textContent = "å°šæœªé€‰æ‹©æ–‡ä»¶ã€‚";
        return;
      }

      const reader = new FileReader();
      reader.onload = function (evt) {
        try {
          const data = new Uint8Array(evt.target.result);
          const workbook = XLSX.read(data, { type: "array" });
          const sheetName = workbook.SheetNames[0];
          const sheet = workbook.Sheets[sheetName];
          const rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });

          state.rows = rows;
          statusEl.textContent = `å·²è¯»å–å·¥ä½œè¡¨ã€Œ${sheetName}ã€ï¼Œå…± ${rows.length} è¡Œã€‚`;
        } catch (err) {
          console.error(err);
          state.rows = [];
          statusEl.textContent = "è§£æ Excel å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚";
        }
      };
      reader.readAsArrayBuffer(file);
    }

    function generateSnippets() {
      const rows = state.rows || [];
      if (!rows.length) {
        alert("è¯·å…ˆé€‰æ‹© Excel æ–‡ä»¶ï¼Œå¹¶ç¡®ä¿è§£ææˆåŠŸã€‚");
        return;
      }

      const packId = document.getElementById("pack-id").value.trim();
      const packName = document.getElementById("pack-name").value.trim();
      const packSubtitle = document.getElementById("pack-subtitle").value.trim();
      const packSide = document.getElementById("pack-side").value.trim();
      const packEra = document.getElementById("pack-era").value.trim();
      const packStatus = document.getElementById("pack-status").value;
      const codePrefix = document.getElementById("code-prefix").value.trim();

      if (!packId || !packName) {
        alert("è‡³å°‘è¦å¡«ï¼šå¡åŒ… id å’Œ å¡åŒ…åç§°ã€‚");
        return;
      }

      // â‘  ç”Ÿæˆ packs é‡Œçš„å¯¹è±¡ç‰‡æ®µ
      const packSnippet = `{
  id: "${esc(packId)}",
  name: "${esc(packName)}",
  subtitle: "${esc(packSubtitle)}",
  side: "${esc(packSide)}",
  era: "${esc(packEra)}",
  status: "${esc(packStatus)}",
  description: "åœ¨è¿™é‡Œå†™ä¸€å¥å¯¹ã€Œ${esc(packName)}ã€çš„ä»‹ç»ã€‚",
  note: ""
},`;

      packOutput.value = packSnippet;

      // â‘¡ ç”Ÿæˆ cards é‡Œçš„æ¡ç›®
      const cardObjects = [];

      rows.forEach((row, index) => {
        const name = (row.name || row["name"] || "").trim();
        if (!name) return; // è·³è¿‡ç©ºè¡Œ

        const category = (row.category || row["category"] || "").trim();
        const number = String(row.number || row["number"] || "").trim();
        const atkHp = String(row["atk&hp"] || row["atk&HP"] || row["ATK&HP"] || "").trim();
        const rawTags = String(row.tags || row["tags"] || "").trim();
        const text = String(row.text || row["text"] || "").trim();

        const tags =
          rawTags.length > 0
            ? rawTags.split(/[ï¼Œ,]/).map((t) => t.trim()).filter(Boolean)
            : [];

        const code =
          codePrefix.length > 0
            ? `${codePrefix}-${String(index + 1).padStart(2, "0")}`
            : "";

        cardObjects.push({
          code,
          name,
          type: category,
          count: number,
          stats: atkHp,
          role: packSide,
          tags,
          text
        });
      });

      if (!cardObjects.length) {
        cardsOutput.value = "// æ²¡æœ‰ä» Excel ä¸­è¯»åˆ°ä»»ä½•æœ‰æ•ˆè¡Œï¼Œè¯·æ£€æŸ¥è¡¨å¤´å’Œå†…å®¹ã€‚";
        return;
      }

      const lines = [];
      lines.push(`// data/cards-${esc(packId)}.js`);
      lines.push(`// ${packName} çš„å•å¡æ•°æ®ï¼ˆç”± card-gen ç”Ÿæˆï¼Œä½ å¯ä»¥å†æ‰‹å·¥å¾®è°ƒï¼‰`);
      lines.push("");
      lines.push("window.CARD_PACK_CARDS = [");

      cardObjects.forEach((card, idx) => {
        const tagArray =
          card.tags && card.tags.length
            ? `[${card.tags.map((t) => `"${esc(t)}"`).join(", ")}]`
            : "[]";

        lines.push("  {");
        if (card.code) lines.push(`    code: "${esc(card.code)}",`);
        lines.push(`    name: "${esc(card.name)}",`);
        if (card.type) lines.push(`    type: "${esc(card.type)}",`);
        if (card.count) lines.push(`    count: "${esc(card.count)}",`);
        if (card.stats) lines.push(`    stats: "${esc(card.stats)}",`);
        if (card.role) lines.push(`    role: "${esc(card.role)}",`);
        if (card.tags && card.tags.length) {
          lines.push(`    tags: ${tagArray},`);
        }
        if (card.text) {
          lines.push(`    text: "${esc(card.text)}"`);
        } else {
          // å¦‚æœæ²¡æœ‰ textï¼ŒæŠŠæœ€åä¸€è¡Œå¤šä½™çš„é€—å·å¹²æ‰
          if (lines[lines.length - 1].trim().endsWith(",")) {
            lines[lines.length - 1] = lines[lines.length - 1].replace(/,+\s*$/, "");
          }
        }
        lines.push(idx === cardObjects.length - 1 ? "  }" : "  },");
      });

      lines.push("];");

      cardsOutput.value = lines.join("\n");
    }

    fileInput.addEventListener("change", handleFileChange);
    generateBtn.addEventListener("click", generateSnippets);
  </script>
</body>
</html>
